
CREATE DATABASE ProyectBD;
USE ProyectBD;

CREATE TABLE Carta(
    IDCarta VARCHAR(50) PRIMARY KEY,
    Palo VARCHAR(20),
    Numero INT,
    Imagen VARCHAR(255)
);

CREATE TABLE Usuario(
    IDUsuario INT AUTO_INCREMENT PRIMARY KEY,
    Nombre VARCHAR(50),
    contra VARCHAR(255)
);

CREATE TABLE Administrador(
    IDUsuario INT PRIMARY KEY,
    FOREIGN KEY (IDUsuario) REFERENCES Usuario(IDUsuario)
);

CREATE TABLE Jugador(
    IDUsuario INT PRIMARY KEY,
    FOREIGN KEY (IDUsuario) REFERENCES Usuario(IDUsuario)
);

CREATE TABLE Partida(
    IDPartida INT PRIMARY KEY,
    hora TIME,
    fecha DATE,
    estado ENUM('suspendido', 'finalizado')
);

CREATE TABLE Mano(
    IDMano INT PRIMARY KEY,
    IDUsuario INT,
    IDPartida INT,
    FOREIGN KEY (IDUsuario) REFERENCES Usuario(IDUsuario),
    FOREIGN KEY (IDPartida) REFERENCES Partida(IDPartida)
);

CREATE TABLE Juegan(
    IDUsuario INT,
    IDPartida INT,
    PRIMARY KEY (IDUsuario, IDPartida),
    FOREIGN KEY (IDUsuario) REFERENCES Usuario(IDUsuario),
    FOREIGN KEY (IDPartida) REFERENCES Partida(IDPartida)
);

CREATE TABLE Compone(
    IDMano INT,
    IDCarta VARCHAR(50),
    PRIMARY KEY (IDMano, IDCarta),
    FOREIGN KEY (IDMano) REFERENCES Mano(IDMano),
    FOREIGN KEY (IDCarta) REFERENCES Carta(IDCarta)
);





-- Procedimiento Mano
DELIMITER //
CREATE PROCEDURE insertarMano(
IN m_Jugador INT,
IN m_Partida INT,
OUT m_IdMano INT
)
BEGIN
DECLARE m_IdMano INT;
INSERT INTO mano(IDJugador, IDPartida)
VALUES(m_Jugador, m_Partida);
SET m_IdMano= LAST_INSERT_ID();
END//
DELIMITER ;

-- Procedimiento Tabla Compone

DELIMITER //
CREATE PROCEDURE insertarCartas(
IN m_IdMano INT,
IN m_IdCarta VARCHAR(50)
)
BEGIN
INSERT INTO Compone(IDMano, IDCarta)
VALUES(m_IdMano, m_IdCarta);
END//
DELIMITER ;

-- Procedimiento para Partida

DELIMITER //
CREATE PROCEDURE guardarPartida(
IN m_IDPartida INT,
IN m_Hora VARCHAR(50),
IN m_Fecha DATE,
IN m_Estado VARCHAR(50)
)
BEGIN
INSERT INTO Partida(IDPartida, hora, fecha, estado)
VALUES(m_IDPartida, m_Hora, m_Fecha, m_Estado);
END//
DELIMITER ;


//urel
//http://localhost/phpYmysql/conexion.php
//http://localhost/phpmyadmin
--------------------------------------------------------------------
Ya que la estructura de la base de datos está definida, asegurémonos de tener un usuario rootAdmin en la tabla Usuario, y que su ID también se inserte en la tabla Administrador.

Primero, inserta el usuario rootAdmin en la tabla Usuario:

INSERT INTO Usuario (IDUsuario, Nombre) VALUES (1, 'rootAdmin');

Luego, inserta este usuario en la tabla Administrador, vinculando su IDUsuario:

INSERT INTO Administrador (IDUsuario) VALUES (1);

la contrasela del administrador es :1234
el usuario del root es :rootAdmin

tube que alterar la tabla usuario

ALTER TABLE usuario ADD contra VARCHAR(255);

INSERT INTO usuario (IDUsuario, Nombre, contra) VALUES (1, 'rootAdmin', '$2y$10$LEHWcLQsWIJ5pPGj9Q1Qye375g6XVNC8xGXu4KNxxAU2vKtynO03G');
INSERT INTO Administrador (IDUsuario) VALUES (1);

INSERT INTO usuario (IDUsuario, Nombre, contra) VALUES (2, 'jugadorPC', '$2y$10$LEHWcLQsWIJ5pPGj9Q1Qye375g6XVNC8xGXu4KNxxAU2vKtynO03G');
INSERT INTO jugador (IDUsuario) VALUES (1);

CREATE USER 'Administrador'@'%' IDENTIFIED BY 'Admin123';
GRANT ALL PRIVILEGES ON ProyectBD.* TO 'Administrador'@'%';
CREATE USER 'usuario'@'%' IDENTIFIED BY 'usuario';
GRANT EXECUTE ON PROCEDURE ProyectBD.insertarMano TO 'usuario'@'%';
GRANT EXECUTE ON PROCEDURE ProyectBD.insertarCartas TO 'usuario'@'%';
GRANT EXECUTE ON PROCEDURE ProyectBD.guardarPartida TO 'usuario'@'%';
